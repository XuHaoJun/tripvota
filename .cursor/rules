# Tripvota Cursor Rules

## Monorepo

- `typescript-workspace`: ConnectRPC frontend
- `rust-workspace`: Backend services
- `share/proto`: Protobuf definitions

## Protobuf Workflow

1. Edit `.proto` in `share/proto`
2. Regenerate TS: `pnpm --filter @workspace/proto-gen generate` (commit generated files)
3. Rust: Auto-generates on build via `build.rs`

## ConnectRPC

- Keep proto changes backward-compatible
- Frontend: Import from `packages/proto-gen`
- Backend: Rebuild after proto updates

## Naming Conventions

**Database (PostgreSQL)**: snake_case tables/columns (`trip_cards`, `trip_id`, `created_at`)

**TypeScript**:

- Types: PascalCase from table names (`TripCard` from `trip_cards`)
- Fields: camelCase from columns (`tripId` from `trip_id`, `createdAt` from `created_at`)
- Props: PascalCase + `Props` suffix (`TripCardProps`)
- Draft/scheduled cards use unified `TripCard` type with `status` field

**Rust**: PascalCase entities (`TripCards`), snake_case fields (match DB)

## Backend Database Workflow

**Schema-First Approach** (always follow this order):

1. **Add Migration**: Create new migration in `rust-workspace/packages/migration/src/`

   - Name: `mYYYYMMDD_HHMMSS_description.rs`
   - Implement both `up()` and `down()` methods
   - Register in `migration/src/lib.rs`

2. **Run Migration**: Execute `cargo run --package migration up` to apply schema changes

3. **Generate Entities**: Run `./scripts/generate-entities.sh` to regenerate entity files from the actual database schema
   - Inspects PostgreSQL database and generates Rust entity models
   - Output: `rust-workspace/packages/entity/src/`

**Never** manually edit entity files - always regenerate from database after migrations.
