# GraphQL Contracts for Bot Management

## Bot List Query

Fetches a paginated list of bots with filtering and sorting support.

```graphql
query GetBots(
  $first: Int
  $after: Cursor
  $filter: BotFilter
  $orderBy: [BotOrderBy!]
) {
  bots(
    first: $first
    after: $after
    filter: $filter
    orderBy: $orderBy
  ) {
    edges {
      node {
        id
        realmId
        name
        displayName
        description
        isActive
        capabilities
        createdAt
        updatedAt
        apiChannelBridgeId
        oauthChannelBridgeId
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}
```

### Variables Example
```json
{
  "first": 20,
  "after": null,
  "filter": {
    "realmId": {
      "equalTo": "550e8400-e29b-41d4-a716-446655440000"
    },
    "isActive": {
      "equalTo": true
    }
  },
  "orderBy": ["CREATED_AT_DESC"]
}
```

## Bot Detail Query

Fetches a single bot by ID with all fields and relations.

```graphql
query GetBot($id: UUID!) {
  bot(id: $id) {
    id
    realmId
    name
    displayName
    description
    isActive
    capabilities
    metadata
    createdAt
    updatedAt
    apiChannelBridgeId
    oauthChannelBridgeId
    realm {
      id
      name
    }
    apiChannelBridge {
      id
      name
      type
    }
    oauthChannelBridge {
      id
      name
      type
    }
  }
}
```

### Variables Example
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000"
}
```

## Type Definitions

These types are auto-generated by PostGraphile v5 with `@graphile/simplify-inflection`.

### Bot Type
```graphql
type Bot {
  id: UUID!
  realmId: UUID!
  name: String!
  displayName: String!
  description: String
  apiChannelBridgeId: UUID
  oauthChannelBridgeId: UUID
  isActive: Boolean!
  capabilities: [String!]
  metadata: JSON
  createdAt: Datetime!
  updatedAt: Datetime!
  realm: Realm
  apiChannelBridge: ChannelBridge
  oauthChannelBridge: ChannelBridge
}
```

### BotConnection Type
```graphql
type BotConnection {
  edges: [BotEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type BotEdge {
  node: Bot!
  cursor: Cursor!
}
```

### BotFilter Input
```graphql
input BotFilter {
  id: UUIDFilter
  realmId: UUIDFilter
  name: StringFilter
  displayName: StringFilter
  isActive: BooleanFilter
  createdAt: DatetimeFilter
  updatedAt: DatetimeFilter
  and: [BotFilter!]
  or: [BotFilter!]
  not: BotFilter
}
```

### BotOrderBy Enum
```graphql
enum BotOrderBy {
  ID_ASC
  ID_DESC
  REALM_ID_ASC
  REALM_ID_DESC
  NAME_ASC
  NAME_DESC
  DISPLAY_NAME_ASC
  DISPLAY_NAME_DESC
  IS_ACTIVE_ASC
  IS_ACTIVE_DESC
  CREATED_AT_ASC
  CREATED_AT_DESC
  UPDATED_AT_ASC
  UPDATED_AT_DESC
}
```

## Type Generation

These GraphQL queries should be written in TypeScript files using `gql` from `graphql-tag`. After running `pnpm codegen`, TypeScript types will be generated:

- **Schema Types**: `lib/graphql/schema.types.ts` - Contains `Bot`, `BotConnection`, `BotFilter`, `BotOrderBy`, etc.
- **Operation Types**: `lib/graphql/types.ts` - Contains `GetBotsQuery`, `GetBotsQueryVariables`, `GetBotQuery`, `GetBotQueryVariables`, etc.

Example usage:
```typescript
import gql from 'graphql-tag';
import type { GetBotsQuery, GetBotsQueryVariables } from '@/lib/graphql/types';

export const BOTS_QUERY = gql`
  query GetBots($first: Int, $after: Cursor, $filter: BotFilter, $orderBy: [BotOrderBy!]) {
    # ... query content ...
  }
`;

// Use generated types for type safety
const variables: GetBotsQueryVariables = {
  first: 20,
  filter: { isActive: { equalTo: true } },
};
```

## Notes

1. **Mutations NOT included**: Create, update, and delete operations are handled via ConnectRPC, not GraphQL mutations.

2. **Pagination**: Uses Relay cursor-based pagination with `first`/`after` parameters.

3. **Filtering**: Supports complex filtering via `postgraphile-plugin-connection-filter` with operators like `equalTo`, `notEqualTo`, `in`, `startsWith`, `contains`, etc.

4. **Sorting**: Multiple sort orders can be specified via `orderBy` array.

5. **Field Selection**: Queries should select only needed fields to minimize over-fetching.

6. **Type Safety**: Always use generated types from `lib/graphql/types.ts` for type-safe GraphQL operations. Run `pnpm codegen` after creating or updating queries.

